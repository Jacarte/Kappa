
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%% CHAPTER 1: INTRODUCTION %%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction}
\label{Intro}

\chapterprecishere{\input{quotes/cinderella1.tex}\par\raggedleft--- {\small\textup{MR. Cox} \textbf{1893}, Cinderella: Three hundred and forty-five variants \cite{cox1893cinderella}}}

\lettrine[lines=3]{T}{he} first web browser, Nexus, made its appearance in 1990 \cite{nexus}. 
At its inception, web browsing consisted solely of retrieving and displaying small, static textual web pages. 
In simpler terms, users could only read page content without any interactive components. 
However, the escalating computing power of devices, the proliferation of the internet, the valuation of internet based companies and the demand for more engaging user experiences birthed the concept of executing code in conjunction with web pages. 
In 1995, the Netscape browser revolutionized this concept by introducing JavaScript \cite{10.1007/978-3-642-14107-2_7}, a language that allowed code execution on the client-side.
Interactive web content immediately highlighted benefits: unlike classical native software, web applications do not require installation, are always up-to-date, and are accessible from any device with a web browser. 
Significantly, since the advent of Netscape, all browsers have offered JavaScript support. 
In the present day, the majority of web pages incorporate not only HTML but also JavaScript code, which is executed on client computers. 
Over the past several decades, web browsers have metamorphosed into JavaScript language virtual machines. 
They have evolved into intricate systems capable of running comprehensive applications, such as video and audio players, animation creators, and PDF document renderers, like the one displaying this document.

JavaScript is presently the most widely utilized scripting language in all contemporary web browsers \cite{mulazzani2013fast}.
However, it is not without limitations due to the inherent characteristics of the language.
For instance, each JavaScript engine necessitates the parsing and recompiling of the JavaScript code, resulting in substantial overhead.
In fact, just parsing and compiling JavaScript code consume the majority of the load times of websites \cite{clark}.
In addition to performance limitations, JavaScript also has security concerns \cite{10.1145/1190216.1190252}.
A notable example of this is the lack of memory isolation in JavaScript, which allows extraction of information from other processes \cite{10.1145/3412841.3442001}.
These issues led the Web Consortium (W3C) to standardize a bytecode for the web environment in 2015, which is the \Wasm(Wasm) language.
Hence, \Wasm became the fourth official language for the web.

%\msection{\Wasm}

\Wasm was designed with a focus on speed, portability, self-containment, and security \cite{Haas_2017}.
It allows for all programs to be compiled ahead-of-time from source languages like C/C++ and Rust.
Third-party compilers create \Wasm binaries, potentially including optimizations, as in the case of LLVM.
The Wasm language defines its Instruction Set Architecture as an abstraction, similar to machine code instructions but independent of CPU architectures \cite{wasm_spec}.
This design allows web browsers to compile quickly to target architectures through a fast, one-to-one translation process.

The versatility of WebAssembly extends not just to web browsers, but to backend scenarios as well. 
Research has demonstrated the advantages of utilizing WebAssembly as an intermediary layer, noting improved startup times and more efficient memory usage when compared to containerization and virtualization \cite{pMendkiServerless, 1244493Jacobsson}. 
In response to these findings, the Bytecode Alliance introduced the WebAssembly System Interface (WASI) in 2019 \cite{bytecodealliance, WASI}. 
WASI facilitated the execution of \Wasm\ with a POSIX system interface protocol, thus enabling the direct execution of Wasm in the operating system. 

%In this dissertation, we propose a proactive approach to enhance WebAssembly security through Software Diversification.

\msection{\Wasm security}

WebAssembly is praised for its security, especially for its design that prevents programs from accessing data beyond their own memory. 
However, there has been less focus on potential vulnerabilities and attacks within WebAssembly's own memory \cite{usenixWasm2020}.
In addition, WebAssembly binaries may be inherently vulnerable due to flaws in their source code \cite{DeRoover2022}. 
There are also significant risks from side-channel attacks, as demonstrated by various researchers \cite{ret2spec, 10.1145/3488932.3517411, Swivel}. 
These vulnerabilities are not limited to the web browser environment, as WebAssembly is also used in the backend.

\msection{Software Monoculture}

Web browsers and JavaScript have evolved significantly in the past thirty years, leading to numerous implementations. 
Yet, only Firefox, Chrome, Safari, and Edge are commonly used on devices.
This situation reflects a software monoculture problem wherein a single flaw could impact multiple applications. 
The concept of monoculture is borrowed from biology and symbolizes an ecosystem at risk of extinction due to shared vulnerabilities and lack of diversity. 
Currently, web pages including WebAssembly binaries are centrally served from main servers. 
Thus, this monoculture issue is also applicable to the \Wasm code served to web browsers. 
Despite its design for secure execution and sandboxing, Wasm is not immune to vulnerabilities. 
Therefore, sharing Wasm code through web browsers could also share its vulnerabilities. 

The software monoculture problem exacerbates when considering the edge-cloud computing platforms and their adoption of \Wasm to provide services.
Specifically, in addition to browser clients, thousands of edge devices running \Wasm as backend services could be affected by shared vulnerabilities. 
This scenario suggests that if one node in an edge network is vulnerable, all the others would be vulnerable in the exact same way since the same binary is replicated on each node. 
In simpler terms, the same attacker payload could compromise all edge nodes simultaneously, meaning that a single distributed Wasm binary could trigger a worldwide catastrophe.

\msection{\Wasm malware}

\todo{SHort description of cryptojacking and open challenges, missconception of missing obfuscators.}

\msection{Problem statements}

According to the discussion above, we identify four key problems to be addressed.

\begin{enumerate}[label=\textbf{P\arabic*}, ref=C\arabic*]
	\item \label{prob2} \textbf{Software monoculture}: Identical \Wasm binaries are deployed on multiple nodes and browsers. This situation is a potential threat to the entire ecosystem as potential vulnerabilities are shared.
	 
	\item \label{prob3} \textbf{Side-channel attacks}: \Wasm binaries are vulnerable to side-channel attacks. Current defenses are limited to specific attacks or require the alteration of runtimes.
 
	\item \label{prob4} \textbf{WebAssembly security}: \Wasm ecosystem and binaries are vulnerable to attacks. Existing WebAssembly research mostly reacts to existing vulnerabilities, leaving the potential for unidentified attacks. 
	
	\item \label{prob5} \textbf{WebAssembly malware}: \Wasm malware is a threat, while currently implemented defenses are not enough mostly due to the misconception of missing obfuscators.

\end{enumerate}


\begin{comment}
\msection{Problem statement}

\end{comment}

\msection{Contributions in Software Diversification}

This dissertation introduces tools, strategies, and methodologies designed to address the previously enunciated problem statements via Software Diversification.
Software Diversification is a security-focused process that involves identifying, developing, and deploying program variants of a given original program \cite{okhravi2013survey}.
Pioneers in this field, Cohen \etal \cite{cohen1993operating} and Forrest \etal \cite{595185}, proposed enhancing software diversity through code transformations. 
Their proposal suggested creating program variants while maintaining their functionalities to mitigate potential vulnerabilities.
Subsequently, transformations aimed at reducing the predictability of programs' observable behavior have been suggested. For instance, some researchers proposed diversifying the control flow of programs \cite{davi2015isomeron}, their instruction set \cite{barrantes2003randomized}, or the system calls they utilize \cite{Chew02mitigatingbuffer}. 
A combination of these transformations can yield less predictable and therefore more secure variants.

While previous studies on software diversification have illustrated the removal of vulnerabilities, it can consistently serve as a preemptive solution in every instance. 
Despite the extensive research on software diversification, its application to \Wasm remains largely unexplored. 
Firstly, software diversification could enhance the capabilities of established \Wasm analysis tools by including diversified program variants, thus complicating the task for attackers to exploit any overlooked vulnerabilities. 
Generated as a proactive security measure, these diversified variants could mimic a wider range of real-world conditions, consequently increasing the accuracy of \Wasm analysis tools, including \Wasm malware detectors. 
Secondly, we observed that current solutions to reduce side-channel attacks on \Wasm binaries are either limited to specific attacks or require the alteration of runtimes. 
Software diversification could address yet-to-be-discovered vulnerabilities on \Wasm binaries by creating diversified variants in a manner that is independent of the platform. 
In the realm of software diversification, we present the following contributions.


\begin{enumerate}[label=\textbf{C\arabic*}, ref=C\arabic*]
	\item \label{methodcontrib} \wrule{Experimental contribution:} For each proposed technique we provide an artifact implementation and conduct experiments to assess its capabilities. The artifacts are publicly available. The protocols and results of assessing the artifacts provide guidance for future research.
	
	\item \label{therycontrib} \wrule{Theoretical contribution:} We propose a theoretical foundation in order to improve Software Diversification for \Wasm.
	
	\item \label{generationcontrib} \wrule{Diversity generation:} We generate \Wasm program variants.
	
	\item \label{defensivecontrib} \wrule{Defensive Diversification:} We assess how generated \Wasm program variants could be used for defensive purposes.
	
	\item \label{ofensivecontrib} \wrule{Offensive Diversification:} We assess how generated \Wasm program variants could be used for offensive purposes, yet improving security systems.
	
\end{enumerate}

\begin{table}
	\centering
	\begin{tabular}{l | l l l l }
		\multicolumn{1}{c|}{Contribution} & \multicolumn{4}{c}{Research papers} 
		\\
		&  \ref{crowpaper} & \ref{mewepaper} & \ref{wasmmutatepaper} & \ref{evasionpaper} \\
		\hline
		\ref{methodcontrib} Experimental contribution & \checkmark & \checkmark & \checkmark & \checkmark \\
		\ref{therycontrib} Theoretical contribution  & \checkmark &  &  \checkmark &  \\
		\ref{generationcontrib} Diversity generation   & \checkmark & \checkmark & \checkmark & \checkmark\\
		\ref{defensivecontrib} Defensive diversification   & \checkmark & \checkmark & \checkmark\\
		\ref{ofensivecontrib} Offensive diversification  & & & & \checkmark\\
	\end{tabular}
	\label{contribmap}
	\caption{}
\end{table}

\section{Summary of research papers}

This compilation thesis comprises the following research papers.

\begin{enumerate}[label={\textbf{P\arabic*}:}, ref={P\arabic*}]
	\item \label{crowpaper} \textbf{CROW: Code randomization for WebAssembly bytecode.} \\ 
	\textbf{Javier Cabrera-Arteaga}, Orestis Floros, Oscar Vera-PÃ©rez, Benoit Baudry, Martin Monperrus\\
	\textit{ Measurements, Attacks, and Defenses for the Web (MADWeb 2021), 12 pages} \\
	\url{https://doi.org/10.14722/madweb.2021.23004}
	
	\wrule{Summary:} In this paper, we introduce the first entirely automated workflow for diversifying WebAssembly binaries. 
	We present CROW, an open-source tool that implements software diversification through enumerative synthesis. 
	We assess the capabilities of CROW and examine its application on real-world, security-sensitive programs.
	In general, CROW can create statically diverse variants. 
	Furthermore, we illustrate that the generated variants exhibit different behaviors at runtime.

	
	
	\item \label{mewepaper} \textbf{Multivariant execution at the Edge. } \\
	\textbf{Javier Cabrera-Arteaga},Pierre Laperdrix, Martin Monperrus, Benoit Baudry\\
    \textit{Moving Target Defense (MTD 2022), 12 pages} \\
    \url{https://dl.acm.org/doi/abs/10.1145/3560828.3564007} 
	\wrule{Summary:} 
	In this paper, we synthesize functionally equivalent variants of a deployed edge service. 
	These variants are encapsulated into a single multivariant WebAssembly binary, 
	When executing the service endpoint, a random variant is selected each time a function is invoked.
	Execution of these multivariant binaries occurs on the global edge platform provided by Fastly, as part of a research collaboration. 
	We demonstrate that these multivariant binaries present a diverse range of execution traces throughout the entire edge platform, distributed worldwide, effectively creating a moving target defense.

	
	\item \label{wasmmutatepaper}\textbf{Wasm-mutate: Fast and efficient software diversification for WebAssembly. }\\ 
	\textbf{Javier Cabrera-Arteaga}, Nicholas Fitzgerald, Martin Monperrus, Benoit Baudry\\
	\textit{Under review, 17 pages} \\
	\url{https://arxiv.org/pdf/2309.07638.pdf}    

	\wrule{Summary:}
	%%IMPROVED
	This paper introduces WASM-MUTATE, a compiler-agnostic WebAssembly diversification engine. 
	The engine is designed to swiftly generate semantically equivalent yet behaviorally diverse WebAssembly variants by leveraging an e-graph. 
	We show that WASM-MUTATE can generate tens of thousands of unique WebAssembly variants in mere minutes. 
	Importantly, WASM-MUTATE can safeguard WebAssembly binaries from timing side-channel attacks, such as Spectre.



	\item \label{evasionpaper} \textbf{WebAssembly Diversification for Malware evasion.} \\ 
	\textbf{Javier Cabrera-Arteaga},Tim Toady, Martin Monperrus, Benoit Baudry\\
	\textit{Computers \& Security, Volume 131, 2023, 17 pages} \\
	\wrule{Summary:}  \Wasm, while enhancing rich applications in browsers, also proves efficient in developing cryptojacking malware. 
	Protective measures against cryptomalware have not factored in the potential use of evasion techniques by attackers. 
	This paper delves into the potential of automatic binary diversification in aiding WebAssembly cryptojacking detectors' evasion. 
	We provide proof that our diversification tools can generate variants of WebAssembly cryptojacking that successfully evade VirusTotal and MINOS. 
	We further demonstrate that these generated variants introduce minimal performance overhead, thus verifying binary diversification as an effective evasion technique.

\end{enumerate}


%\todo{End up with the diagram locating our contributions in the landscape.}

\section*{Thesis layout}
This dissertation comprises two parts as a compilation thesis. 
Part one summarises the research papers included within, which is partially rooted in the author's licentiate thesis \cite{Lic}. 
Chapter 2 offers a background on \Wasm and the latest advancements in Software Diversification. 
Chapter 3 delves into our technical contributions. 
Chapter 4 exhibits two use cases applying our technical contributions. 
Chapter 5 concludes the thesis and outlines future research directions. 
The second part of this thesis incorporates all the papers discussed in part one.

