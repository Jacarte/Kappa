\documentclass[openany,g5paper,electronic]{kthesis}

\input{packages}

\usetikzlibrary{tikzmark,calc,decorations.pathreplacing}
\newcommand{\Depth}{2}
\newcommand{\Height}{2}
\newcommand{\Width}{2}

\renewcommand{\labelitemi}{\textcolor{IndianRed3}{\bfseries\textbullet}}


%% For autorefname
\addto\extrasenglish{%
  \renewcommand{\sectionautorefname}{Section}
  \renewcommand{\chapterautorefname}{Chapter}
  \renewcommand{\subsubsectionautorefname}{Subsection}
  \renewcommand{\subsectionautorefname}{Subsection}
  \renewcommand{\algorithmautorefname}{Algorithm}
}
\DeclareGraphicsExtensions{.pdf,.png,.jpg,.eps}

\DeclareFloatingEnvironment[fileext=frm,placement={tph},name=Listing]{code}
\captionsetup[lstlisting]{singlelinecheck=false, margin=0pt}

\input{custom_commands.tex}

\newcommand*\badge[1]{ \colorbox{red}{\color{white}#1}}
\newcommand*\badget[1]{\colorbox{red}{\color{white}#1}}
\newcommand*\badgeg[1]{\colorbox{green}{\color{white}#1}}


\makeatletter
\newenvironment{btHighlight}[1][]
{\begingroup\tikzset{bt@Highlight@par/.style={#1}}\begin{lrbox}{\@tempboxa}}
{\end{lrbox}\bt@HL@box[bt@Highlight@par]{\@tempboxa}\endgroup}


\definecolor{commentgreen}{RGB}{176, 176, 176}
\definecolor{rowcolor}{cmyk}{0,0.87,0.68,0.32}
\definecolor{rowcolor2}{cmyk}{ 20, 0, 37, 34}

\definecolor{eminence}{RGB}{108,48,130}
\definecolor{weborange}{RGB}{255,165,0}
\definecolor{frenchplum}{RGB}{129,20,82}
\definecolor{darkgreen}{RGB}{10, 92, 10}


\definecolor{celadon}{rgb}{0.67, 0.88, 0.69}
%\renewcommand{\blue}{}

\newcommand\btHL[1][]{%
  \begin{btHighlight}[#1]\bgroup\aftergroup\bt@HL@endenv%
}
\def\bt@HL@endenv{%
  \end{btHighlight}%   
  \egroup
}
\newcommand{\bt@HL@box}[2][]{%
  \tikz[#1]{%
    \pgfpathrectangle{\pgfpoint{1pt}{0pt}}{\pgfpoint{\wd #2}{\ht #2}}%
    \pgfusepath{use as bounding box}%
    \node[anchor=base west, fill=orange!30,outer sep=0pt,inner xsep=1pt, inner ysep=0pt, rounded corners=3pt, minimum height=\ht\strutbox+1pt,#1]{\raisebox{1pt}{\strut}\strut\usebox{#2}};
  }%
}
\makeatother

\makeatletter


\lstdefinelanguage{C}{
    otherkeywords={},
    morekeywords=[1]{const, int},
    morekeywords=[2]{0},
    morekeywords=[3]{add,const,mul,shl,get,rem_s,rem_u,ne,tee,sub,set,store},
    morekeywords=[4]{},
    morekeywords=[5]{global, get_global, mut, set_global, export, import,loop, memory, data, get_local,if, block,module, set_local,call,br_if,end, all,call_indirect,local,global,module, func, param, result, type},
    morekeywords=[6]{=,;},
    morekeywords=[7]{(,),[,],.},
    sensitive=false,
    morecomment=[l]{;},
    morecomment=[s]{;}{;},
    morestring=[b]",
    keywordstyle=[1]\color{eminence}\bfseries,
    keywordstyle=[3]\color{frenchplum},
    keywordstyle=[5]\color{darkgreen}\bfseries,
    commentstyle=\color{commentgreen}
}

\lstdefinelanguage{WAT}{
    otherkeywords={},
    morekeywords=[1]{i32,f32,i64,f64},
    morekeywords=[2]{0},
    morekeywords=[3]{add,const,mul,shl,get,rem_s,rem_u,ne,tee,sub,set,store},
    morekeywords=[4]{},
    morekeywords=[5]{global, get_global, mut, set_global, export, import,loop, memory, data, get_local,if, block,module, set_local,call,br_if,end, all,call_indirect,local,global,module, func, param, result, type},
    morekeywords=[6]{=,;},
    morekeywords=[7]{(,),[,],.},
    sensitive=false,
    morecomment=[l]{;},
    morecomment=[s]{;}{;},
    morestring=[b]",
    keywordstyle=[1]\color{eminence}\bfseries,
    keywordstyle=[3]\color{frenchplum},
    keywordstyle=[5]\color{darkgreen}\bfseries,
    commentstyle=\color{commentgreen}
}
\lstdefinelanguage{llvm}{
    morecomment = [l]{;},
    morestring=[b]", 
    sensitive = true,
    morekeywords=[2]{i32,f32,i64,f64},
    morekeywords=[3]{
        define, declare, global, constant,
        internal, external, private,
        linkonce, linkonce_odr, weak, weak_odr, appending,
        common, extern_weak,
        thread_local, dllimport, dllexport,
        hidden, protected, default,
        except, deplibs,
        volatile, fastcc, coldcc, cc, ccc,
        x86_stdcallcc, x86_fastcallcc,
        ptx_kernel, ptx_device,
        signext, zeroext, inreg, sret, nounwind, noreturn,
        nocapture, byval, nest, readnone, readonly, noalias, uwtable,
        inlinehint, noinline, alwaysinline, optsize, ssp, sspreq,
        noredzone, noimplicitfloat, naked, alignstack,
        module, asm, align, tail, to,
        addrspace, section, alias, sideeffect, c, gc,
        target, datalayout, triple,
        blockaddress
    },
    morekeywords=[4]{
        fadd, sub, fsub, mul, fmul,
        sdiv, udiv, fdiv, srem, urem, frem,
        and, or, xor,
        icmp, fcmp,
        eq, ne, ugt, uge, ult, ule, sgt, sge, slt, sle,
        oeq, ogt, oge, olt, ole, one, ord, ueq, ugt, uge,
        ult, ule, une, uno,
        nuw, nsw, exact, inbounds,
        phi, call, select, shl, lshr, ashr, va_arg,
        trunc, zext, sext,
        fptrunc, fpext, fptoui, fptosi, uitofp, sitofp,
        ptrtoint, inttoptr, bitcast,
        ret, br, indirectbr, switch, invoke, unwind, unreachable,
        malloc, alloca, free, load, store, getelementptr,
        extractelement, insertelement, shufflevector,
        extractvalue, insertvalue,
    },
    alsoletter={\%},
    keywordsprefix={\%},% All identifiers starting with '%' will be printed as first order keywords.
    keywordstyle=[1]\bfseries,% As mentioned above, these are the keywords starting with '%', like '%5'
    keywordstyle=[2]\color{eminence}\bfseries,
    keywordstyle=[3]\color{darkgreen}\bfseries,
    keywordstyle=[4]\color{frenchplum},
}
\makeatother

\newcommand{\todo}[1]{%
%\refstepcounter{todo}
\noindent\textbf{\badge{TODO}} {\color{red} #1}
%\addcontentsline{td}{todo}
%{\color{red}\thesection.\thetodo\xspace #1}
}

\newcommand{\done}[1]{%
\noindent\textbf{\badgeg{DONE}} {\color{green}#1}
}
\newcommand{\citationneeded}{
  \badget{[?]}
}

\newcommand*\step[1]{
\noindent\tikz[baseline=(char.base)]{
        \node[shape=circle,text=black,draw=black, fill=white,inner sep=1.2pt] (char) {#1};}}



\newtheorem{definition}{Definition}
\providecommand*{\definitionautorefname}{Definition}
\newtheorem{metric}{Metric}
\providecommand*{\metricautorefname}{Metric}



\newtheorem{property}{Property}
\providecommand*{\propertyautorefname}{Property}

\hyphenation{Web-Assembly}
\hyphenation{super-optimizers}
\hyphenation{super-optimize}

%\addcontentsline{td}{todo}
%{\color{red}\thesection.\thetodo\xspace Citation needed}}


\makeatletter
\lstset{
    %language=C,
    basicstyle=\ttfamily\footnotesize\lst@ifdisplaystyle\scriptsize\fi,
    escapeinside={\%*}{*)},
    captionpos=t
}
\makeatother


\lstdefinestyle{CStyle}{
  %numbers=none,
  stepnumber=1,
  numbersep=10pt,
  tabsize=4,
  showspaces=false,
  showstringspaces=false,
  basicstyle=\scriptsize\ttfamily,
  %moredelim=**[is][{\btHL[fill=black!10]}]{`}{`},
  moredelim=**[is][{\btHL[fill=celadon!40]}]{@}{@}
}

\lstdefinestyle{WATStyle}{
  numbers=left,
  stepnumber=1,
  numbersep=5pt,
  tabsize=4,
  showspaces=false,
  showstringspaces=false,
}

\lstdefinestyle{LLVMStyle}{
  numbers=none,
  stepnumber=0,
  numbersep=10pt,
  tabsize=4,
  showspaces=false,
  showstringspaces=true,
}



\getenv[\NOWIDOW]{NOWIDOW}
\ifthenelse{\equal{\NOWIDOW}{True}}%
    {
      \widowpenalties 1 10000
      \raggedbottom

      \setlength{\parskip}{20pt}

      \titlecontents{chapter}[0pc]
      {\addvspace{15pt}}%
      {\large\bfseries}
      {\large\bfseries}
      {\bfseries\hfill\large}%
      
      \titlecontents{subsection}
      [10.0em]{}
      {\normalsize\contentslabel{3.3em}}
      {\hspace*{-2.3em}}
      {\titlerule*[1pc]{ }}

      \titlecontents{section}
      [10.0em]{}
      {\normalsize\contentslabel{3.3em}}
      {\hspace*{-2.3em}}
      {\titlerule*[1pc]{ }}


      \renewcommand\labelitemi{}


        % section tiltes formatting
        \titleformat{\section}
        {\Large}{}{1em}{#1}
        \titleformat{name=\section,numberless}
        {\Large}{}{1em}{#1}

        % subsection tiltes formatting
        \titleformat{\subsection}
        {\Large}{}{1em}{#1}
        \titleformat{name=\subsection,numberless}
        {\Large}{}{1em}{#1}

        \titleformat{\chapter}[display]
        {\LARGE}
        {\renewcommand{\thechapter}{}
        %\colorbox{blacm}
        {{\bfseries\fontsize{30}{40}\selectfont
        \thechapter
          \parbox[c][1.2cm][c]{1cm}{%
            \centering\textcolor{black}  {}}}}}
        {-1ex}
        {%\color{black}\titlerule
        \vspace{-1.9ex}\filleft\MakeUppercase{#1}}
        [
        ]
    } % 
    {} %

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% Document starts here %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% First and second pages %%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\input{Kappa-bibl}

\pretolerance=10000
\tolerance=4000 
\emergencystretch=10pt
% Create title page using info above
\maketitle

\frontmatter % Pages i, ii, iii, iv, v etc.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%% ABSTRACT %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
\noindent \lipsum[1]

\end{abstract}

\bigskip \bigskip \bigskip \bigskip \bigskip

\setlength{\leftskip}{0.3 cm} \textbf {Keywords:} Lorem, Ipsum, Dolor, Sit, Amet

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%% SWEDISH ABSTRACT %%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\selectlanguage{swedish}
\begin{abstract}
\noindent \lipsum[1]
\end{abstract}
\selectlanguage{english}

\input{ListOfPapers}
\input{ack}
\input{acronyms}

\mainmatter % Pages 1, 2, 3...
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%% TABLE OF CONTENTS %%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\tableofcontents
\part{Thesis}
\clearpage

\input{chapters/Chapter1}
\input{chapters/Chapter2}
\input{chapters/Chapter3}
\input{chapters/Chapter4}
\input{chapters/Chapter5}
%\input{chapters/Chapter6}

%------------------------------------------------
% CREATING THE BIBLIOGRAPHY
%------------------------------------------------
\bibliographystyle{ieeetr}
\renewcommand{\bibname}{References}% changes default name Bibliography to References
\bibliography{Kappa} % References file

%--------------------------------------------------
%\addcontentsline{toc}{chapter}{Appended papers} % for template purposes
\input{Contributions}
\printindex

\end{document}
\endinput
%%
%% End of file `kth-demo.tex'.
